<div class="temas-container">
  <div class="page-header">
    <div class="breadcrumb">
      <button (click)="volverAMaterias()" class="btn-link">üìö Materias</button>
      <span>></span>
      <span>{{ materia?.nombre || 'Cargando...' }}</span>
    </div>
    <h1>Temas de {{ materia?.nombre || 'Cargando...' }}</h1>
    <p>Gestiona los temas de esta materia</p>
    <button (click)="crearTema()" class="btn-primary">
      üìñ Nuevo Tema
    </button>
  </div>

  <!-- Mensaje de error -->
  @if (error) {
    <div class="error">
      {{ error }}
    </div>
  }

  <!-- Formulario de Tema -->
  @if (mostrarFormulario) {
    <div class="form-overlay">
      <div class="form-container">
        <div class="form-header">
          <h3>{{ modoEdicion ? 'Editar Tema' : 'Nuevo Tema' }}</h3>
          <button (click)="cancelarEdicion()" class="btn-close">√ó</button>
        </div>
        
        <form (ngSubmit)="guardarTema()">
          <div class="form-group">
            <label>T√≠tulo del Tema:</label>
            <input type="text" 
                   [(ngModel)]="formTitulo" 
                   name="formTitulo" 
                   placeholder="Ej: Variables y Tipos de Datos"
                   required>
          </div>

          <div class="form-group">
            <label>Descripci√≥n:</label>
            <textarea 
              [(ngModel)]="formDescripcion" 
              name="formDescripcion" 
              placeholder="Describe el contenido de este tema..."
              rows="4"
              required></textarea>
          </div>

          <div class="form-group">
            <label>Orden:</label>
            <input type="number" 
                   [(ngModel)]="formOrden" 
                   name="formOrden" 
                   min="1"
                   required>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary">
              {{ modoEdicion ? 'Actualizar' : 'Crear' }} Tema
            </button>
            <button type="button" (click)="cancelarEdicion()" class="btn-secondary">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- Modal de Detalles -->
  @if (mostrarDetalles && temaViendo) {
    <div class="modal-overlay">
      <div class="modal-container">
        <div class="modal-header">
          <h3>Detalles del Tema</h3>
          <button (click)="cancelarEdicion()" class="btn-close">√ó</button>
        </div>
        
        <div class="modal-content">
          <div class="tema-details">
            <div class="detail-row">
              <strong>T√≠tulo:</strong>
              <span>{{ temaViendo.titulo }}</span>
            </div>
            <div class="detail-row">
              <strong>Descripci√≥n:</strong>
              <span>{{ temaViendo.descripcion }}</span>
            </div>
            <div class="detail-row">
              <strong>Orden:</strong>
              <span class="badge orden">{{ temaViendo.orden }}</span>
            </div>
            <div class="detail-row">
              <strong>Fecha Creaci√≥n:</strong>
              <span>{{ formatearFecha(temaViendo.created_at) }}</span>
            </div>
            <div class="detail-row">
              <strong>Total de Subtemas:</strong>
              <span class="badge info">{{ contarSubtemas(temaViendo) }}</span>
            </div>
            
            @if (temaViendo.subtemas && temaViendo.subtemas.length > 0) {
              <div class="subtemas-list">
                <h4>üìë Subtemas de este Tema</h4>
                <div class="subtemas-grid">
                  @for (subtema of temaViendo.subtemas; track subtema.id) {
                    <div class="subtema-card">
                      <div class="subtema-header">
                        <span class="subtema-orden">{{ subtema.orden }}</span>
                        <h5>{{ subtema.titulo }}</h5>
                      </div>
                      <p class="subtema-descripcion">{{ subtema.descripcion }}</p>
                    </div>
                  }
                </div>
              </div>
            } @else {
              <div class="empty-subtemas">
                <p>üìù Este tema a√∫n no tiene subtemas asignados.</p>
                <button (click)="verSubtemas(temaViendo!)" class="btn-primary">
                  Gestionar Subtemas
                </button>
              </div>
            }
          </div>
        </div>
        
        <div class="modal-actions">
          <button (click)="verSubtemas(temaViendo!)" class="btn-primary">
            üìë Gestionar Subtemas
          </button>
          <button (click)="editarTema(temaViendo!)" class="btn-edit">
            ‚úèÔ∏è Editar Tema
          </button>
          <button (click)="cancelarEdicion()" class="btn-secondary">
            Cerrar
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Lista de Temas -->
  <div class="table-container">
    @if (cargando) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando temas...</p>
      </div>
    }

    @if (!cargando && temas.length === 0) {
      <div class="empty-state">
        <div class="empty-icon">üìñ</div>
        <h3>No hay temas registrados</h3>
        <p>Crea el primer tema de esta materia</p>
        <button (click)="crearTema()" class="btn-primary">
          Crear Primer Tema
        </button>
      </div>
    }

    @if (!cargando && temas.length > 0) {
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Orden</th>
              <th>T√≠tulo</th>
              <th>Descripci√≥n</th>
              <th>Subtemas</th>
              <th>Fecha Creaci√≥n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (tema of temas; track tema.id) {
              <tr>
                <td>
                  <span class="badge orden">{{ tema.orden }}</span>
                </td>
                <td class="tema-titulo">{{ tema.titulo }}</td>
                <td class="tema-descripcion">
                  {{ tema.descripcion || 'Sin descripci√≥n' }}
                </td>
                <td>
                  <span class="badge info">{{ contarSubtemas(tema) }}</span>
                </td>
                <td>
                  {{ formatearFecha(tema.created_at) }}
                </td>
                <td class="actions">
                  <button (click)="verDetalles(tema)" class="btn-view" title="Ver detalles">
                    üëÅÔ∏è
                  </button>
                  <button (click)="verSubtemas(tema)" class="btn-subtemas" title="Ver subtemas">
                    üìë
                  </button>
                  <button (click)="editarTema(tema)" class="btn-edit" title="Editar">
                    ‚úèÔ∏è
                  </button>
                  <button (click)="eliminarTema(tema)" class="btn-delete" title="Eliminar">
                    üóëÔ∏è
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</div>